<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:KarjalaBasket.Scoreboard.ViewModels"
             xmlns:v="clr-namespace:KarjalaBasket.Scoreboard.Views"
             x:Class="KarjalaBasket.Scoreboard.Pages.MainPage"
             x:DataType="vm:MainViewModel"
             Padding="10">
    
    <ContentPage.BindingContext>
        <vm:MainViewModel />
    </ContentPage.BindingContext>
    
    <Grid RowSpacing="10" ColumnSpacing="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>
        
        <Entry Grid.Row="0" Grid.Column="0" 
               Placeholder="Команда слева" 
               FontSize="30" 
               HorizontalTextAlignment="Center" 
               HorizontalOptions="Fill"
               Text="{Binding TeamA.Name, Mode=TwoWay}" />
        
        <Entry Grid.Row="0" Grid.Column="2" 
               Placeholder="Команда справа" 
               FontSize="30" 
               HorizontalTextAlignment="Center" 
               HorizontalOptions="Fill"
               Text="{Binding TeamB.Name, Mode=TwoWay}" />
        
        <v:PlayersView Grid.Row="1" Grid.Column="0" 
                       Players="{Binding TeamA.Players, Mode=TwoWay}"
                       AddPlayerCommand="{Binding TeamA.AddPlayerCommand}"
                       GameSettings="{Binding GameSettings}"/>
        
        <Grid Grid.Row="0" Grid.Column="1" Grid.RowSpan="2" RowSpacing="30">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/> <!--Счет-->
                <RowDefinition Height="Auto"/> <!--Фолы Период-->
                <RowDefinition Height="Auto"/> <!--Период Таймауты-->
                <RowDefinition Height="Auto"/> <!--Основное время-->
                <RowDefinition Height="Auto"/> <!--Время владения-->
                <RowDefinition Height="Auto"/> <!--Старт/стоп--> 
                <RowDefinition Height="Auto"/> <!--Доп функции--> 
            </Grid.RowDefinitions>
            
            <Entry Grid.Row="0" Grid.Column="0" FontSize="50" 
                   ToolTipProperties.Text="Очки команды слева"
                   VerticalTextAlignment="Center" 
                   HorizontalTextAlignment="Center"
                   HorizontalOptions="Center"
                   MinimumWidthRequest="110"
                   Text="{Binding TeamA.Points, Mode=TwoWay}" />
            
            <Entry Grid.Row="0" Grid.Column="2" 
                   ToolTipProperties.Text="Очки команды справа"
                   FontSize="50" 
                   VerticalTextAlignment="Center" 
                   HorizontalTextAlignment="Center"
                   HorizontalOptions="Center"
                   MinimumWidthRequest="110"
                   Text="{Binding TeamB.Points, Mode=TwoWay}"/>
            
            <v:StepperView Grid.Row="1" Grid.Column="0" 
                           HorizontalOptions="Fill"
                           FontSize="30"
                           Max="{Binding GameSettings.MaxTeamFouls}"
                           Label="Фолы"
                           Value="{Binding TeamA.Fouls, Mode=TwoWay}"/>
            
            <v:StepperView Grid.Row="1" Grid.Column="1" Grid.RowSpan="2" 
                           HorizontalOptions="Fill"
                           FontSize="30"
                           Label="Период"
                           Min="1"
                           Value="{Binding Period, Mode=TwoWay}"/>
            
            <v:StepperView Grid.Row="1" Grid.Column="2"
                           HorizontalOptions="Fill"
                           FontSize="30"
                           Max="{Binding GameSettings.MaxTeamFouls}"
                           Label="Фолы"
                           Value="{Binding TeamB.Fouls, Mode=TwoWay}"/>
            
            <v:StepperView Grid.Row="2" Grid.Column="0"
                           HorizontalOptions="Fill"
                           FontSize="30"
                           Max="{Binding GameSettings.SecondHalfTimeouts}"
                           Label="Таймауты"
                           Value="{Binding TeamA.Timeouts, Mode=TwoWay}"/>
            
            <v:StepperView Grid.Row="2" Grid.Column="2"
                           HorizontalOptions="Fill"
                           FontSize="30"
                           Max="{Binding GameSettings.SecondHalfTimeouts}"
                           Label="Таймауты"
                           Value="{Binding TeamB.Timeouts, Mode=TwoWay}"/>
            
            <Grid Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="3" ColumnSpacing="5" RowSpacing="10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <Label Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="12" 
                       HorizontalOptions="Center" 
                       Text="Время периода" 
                       FontSize="16"/>
                
                <v:TimeEntryView Grid.Row="1" Grid.Column="3" Grid.ColumnSpan="2"
                                 FontSize="30"
                                 Label="м"
                                 ToolTip="Минуты"
                                 Value="{Binding PeriodMinutes, Mode=TwoWay}"
                                 IsEnabled="{Binding CanEdit, Mode=TwoWay}"/>
                
                <v:TimeEntryView Grid.Row="1" Grid.Column="5" Grid.ColumnSpan="2"
                                 FontSize="30"
                                 Label="с"
                                 ToolTip="Секунды"
                                 Value="{Binding PeriodSeconds, Mode=TwoWay}"
                                 IsEnabled="{Binding CanEdit, Mode=TwoWay}"/>
                
                <v:TimeEntryView Grid.Row="1" Grid.Column="7" Grid.ColumnSpan="2"
                                 FontSize="30"
                                 Label="мс"
                                 ToolTip="Миллисекунды"
                                 Value="{Binding PeriodMilliseconds, Mode=TwoWay}"
                                 IsEnabled="{Binding CanEdit, Mode=TwoWay}"/>
            </Grid>
            
            <Grid Grid.Row="4" Grid.Column="0" Grid.ColumnSpan="3" RowSpacing="10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <Label Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="12" 
                       HorizontalOptions="Center" 
                       Text="Время владения" 
                       FontSize="16"/>

                <v:TimeEntryView Grid.Row="1" Grid.Column="4" Grid.ColumnSpan="2"
                                 FontSize="30"
                                 Label="с"
                                 ToolTip="Секунды"
                                 Value="{Binding PossessionSeconds, Mode=TwoWay}"
                                 IsEnabled="{Binding CanEdit, Mode=TwoWay}"/>
                
                <v:TimeEntryView Grid.Row="1" Grid.Column="6" Grid.ColumnSpan="2"
                                 FontSize="30"
                                 Label="мс"
                                 ToolTip="Миллисекунды"
                                 Value="{Binding PossessionMilliseconds, Mode=TwoWay}"
                                 IsEnabled="{Binding CanEdit, Mode=TwoWay}"/>
                
                <Button Grid.Row="2" Grid.Column="3" Grid.ColumnSpan="2"
                        ToolTipProperties.Text="{Binding GameSettings.PossessionTime.Seconds, StringFormat='{0}с на владение'}"
                        FontSize="20"
                        TextColor="White" 
                        BackgroundColor="{StaticResource Gray950}"
                        MaximumWidthRequest="50"
                        Text="{Binding GameSettings.PossessionTime.Seconds}"
                        Command="{Binding UpdatePossessionTimeCommand}"
                        CommandParameter="{Binding GameSettings.PossessionTime.Seconds}"/>
                
                <Button Grid.Row="2" Grid.Column="5" Grid.ColumnSpan="2"
                        ToolTipProperties.Text="{Binding GameSettings.SecondPossessionTime.Seconds, StringFormat='{0}с на владение'}"
                        FontSize="20"
                        TextColor="White"
                        BackgroundColor="{StaticResource Gray950}"
                        MaximumWidthRequest="50"
                        Text="{Binding GameSettings.SecondPossessionTime.Seconds}"
                        Command="{Binding UpdatePossessionTimeCommand}"
                        CommandParameter="{Binding GameSettings.SecondPossessionTime.Seconds}"/>
                
                <ImageButton Grid.Row="2" Grid.Column="7" Grid.ColumnSpan="2"
                             ToolTipProperties.Text="Сбросить счетчик владения"
                             Source="ban_white.png"
                             Aspect="Center"
                             BackgroundColor="{StaticResource Gray950}"
                             MaximumWidthRequest="50"
                             Command="{Binding UpdatePossessionTimeCommand}"
                             CommandParameter="{x:Null}"/>
            </Grid>
            
            <Grid Grid.Row="5" Grid.Column="0" Grid.ColumnSpan="3">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <ImageButton Grid.Column="2"
                             ToolTipProperties.Text="Старт/Стоп"
                             HorizontalOptions="Center"
                             VerticalOptions="Center"
                             Command="{Binding PlayCommand}"
                             Source="{Binding PlayImageButtonSource}"
                             WidthRequest="60"
                             HeightRequest="60"
                             Aspect="AspectFit"/>
            </Grid>
            
            <Grid Grid.Row="6" Grid.Column="0" Grid.ColumnSpan="3">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <ImageButton Grid.Column="2" 
                             ToolTipProperties.Text="Подать сигнал"
                             HorizontalOptions="Center"
                             VerticalOptions="Center"
                             Command="{Binding MakeSignalCommand}"
                             Source="speaker.png"
                             WidthRequest="30"
                             HeightRequest="30"
                             Aspect="AspectFit"/>
                
                <ImageButton Grid.Column="3" 
                             ToolTipProperties.Text="Перейти в следующий период"
                             HorizontalOptions="Center"
                             VerticalOptions="Center"
                             Command="{Binding GoToNextPeriodCommand}"
                             Source="next.png"
                             WidthRequest="30"
                             HeightRequest="30"
                             Aspect="AspectFit"/>
            </Grid>
        </Grid>
        
        <v:PlayersView Grid.Row="1" Grid.Column="2" 
                       Players="{Binding TeamB.Players, Mode=TwoWay}"
                       AddPlayerCommand="{Binding TeamB.AddPlayerCommand}"
                       GameSettings="{Binding GameSettings}"/>
    </Grid>
    
</ContentPage>
